/*jshint -W098 */
"use strict";

/**
 * Propulsion engine capability, can be mixed into {@link SpaceObject}s.
 * jsdoc limitation: cannot document mixin initialization params, check the source for more info!
 * @param {number} enginePower - the force that is generated by the engine. Direction of the force is based on the heading of the object.
 * @param {number} fuel - Fuel is used while the engine is running, 1 unit per simulation step. This is the initial value.
 * @param {boolean} engineRunning - Initial state of the engine.
 * @mixin
 */
function EnginePowered(enginePower, fuel, engineRunning) {
  this.enginePowered = {
    fuel: fuel || Infinity,
    engineRunning: engineRunning || false
  };
  enginePower = enginePower || 0.0015;
  var props = this.enginePowered;

  var superOneStep = this.oneStep;
  this.oneStep = function () {
    if (this.enginePowered.engineRunning) {
      this.stepForce.add(Vector.createFromPolar(this.heading, enginePower));
      if (--props.fuel <= 0) {
        props.engineRunning = false;
      }
    }
    superOneStep.call(this);
  };

  this.startEngine = function () {
    if (props.fuel > 0) {
      props.engineRunning = true;
    }
  };

  this.stopEngine = function () {
    props.engineRunning = false;
  };
}